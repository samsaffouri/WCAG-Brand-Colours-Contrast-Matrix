<!DOCTYPE html>
<html>
<head>
	<title>Brand Colours</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<style type="text/css">
		body{
			text-align: center;
		}
		table{
			margin: 0 auto;
		}
		tr, table, td{
			border: 1px solid #ccc;

		}
		th{
			width: 75px;
			height: 75px;
			text-align: center;
		}
		.boldCell-bottom{
			border-bottom: 1px solid #999;
			background-color: #efefef;
		}
		.boldCell-right{
			border-right: 1px solid #999;
			background-color: #efefef;
		}
		td{

			width: 75px;
			height: 75px;
			text-align: center;
			text-transform: uppercase;
		}
		ul{
			list-style: none;
			padding: 0px;
		}
		li{
			display: inline-block;
			margin: 10px;
		}
		li input[type=color]{
			width: 50px;
			height: 50px;
		}
		.removeBtn{
			display: none;
			margin: 10px auto;
		}
		.txt-90{
			transform: rotate(-90deg);
		}
		#arrayHere{
			margin-bottom: 100px;
		}
		.mainBtn{
			width: 100px;
		}
	</style>
	<script
  src="https://code.jquery.com/jquery-3.5.0.min.js"
  integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ="
  crossorigin="anonymous"></script>
</head>
<body>
	<div class="container">
	<h1>Brand Colors Matrix</h1>
	<p>Instruction text about application should be here</p>
		<button onclick="myFunction()" class="btn btn-success btn-lg mainBtn">Add</button>
		<button onclick="CheckFunc()" class="btn btn-primary btn-lg mainBtn">check</button>
		<button id="cmd" class="btn btn-warning btn-lg mainBtn">PDF</button>

		<div><label for="wacgLevel">Select WACG Leve:</label>
			<select id="wacgLevel">
			  <option value="aaLevel-sm">Level AA - Normal Text</option>
			  <option value="aaLevel-lg">Level AA - Large Text</option>
			  <option value="aaaLevel-sm">Level AAA - Normal Text</option>
			  <option value="aaaLevel-lg">Level AAA - Large Text</option>
			</select>
		</div>	
	<ul id="container">	
		<li id="color-0">
			<input type="color" name="num" id="bb" value="#000000">
			<input type="text" name="num" value="#000000">
			<button class="removeBtn btn btn-danger" onclick="myRemove(this)">x</button>
		</li>
		<li id="color-1">
			<input type="color" name="num" value="#ffffff">
			<input type="text" name="num" value="#ffffff">
			<button class="removeBtn btn btn-danger	" onclick="myRemove(this)">x</button>
		</li>
	</ul>
	<div id="editor"></div>

	<div id="arrayHere"></div>

</div>

<script type="text/javascript" src="bundle.js"></script>
<script>
	var wacgVar = 1/4.5;
	var wacgTxt = "AA Normal"
	document.getElementById("wacgLevel").addEventListener("change", wLevelFunction);
	function wLevelFunction(){
		var wacg = document.getElementById("wacgLevel").value;
		if (wacg == "aaLevel-lg" ){
			wacgVar = 1/3;
			wacgTxt = "AA Large";		
		}
		if (wacg == "aaLevel-sm" ){
			wacgVar = 1/4.5;
			wacgTxt = "AA Normal";
		}
		if (wacg == "aaaLevel-lg"  ){
			wacgVar = 1/4.5;
			wacgTxt = "AAA Large";
		}	
		if (wacg == "aaaLevel-sm"  ){
			wacgVar = 1/7;
			wacgTxt = "AAA Normal";
		}	
	return 	wacgVar, wacgTxt;
	}
// function from https://stackoverflow.com/a/5624139/3695983
function hexToRgb(hex) {
  var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
  hex = hex.replace(shorthandRegex, function(m, r, g, b) {
    return r + r + g + g + b + b;
  });

  var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? {
    r: parseInt(result[1], 16),
    g: parseInt(result[2], 16),
    b: parseInt(result[3], 16)
  } : null;
}

// function from https://stackoverflow.com/a/9733420/3695983                     
function luminance(r, g, b) {
  var a = [r, g, b].map(function (v) {
    v /= 255;
    return v <= 0.03928
      ? v / 12.92
    : Math.pow( (v + 0.055) / 1.055, 2.4 );
  });
  return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722;
}

function calculateRatio(cl1, cl2) {

  // read the colors and transform them into rgb format
  const color1 = cl1 ;
  const color2 = cl2 ;
  const color1rgb = hexToRgb(color1);
  const color2rgb = hexToRgb(color2);

  // calculate the relative luminance
  const color1luminance = luminance(color1rgb.r, color1rgb.g, color1rgb.b);
  const color2luminance = luminance(color2rgb.r, color2rgb.g, color2rgb.b);

  // calculate the color contrast ratio
  const ratio = color1luminance > color2luminance 
  ? ((color2luminance + 0.05) / (color1luminance + 0.05))
  : ((color1luminance + 0.05) / (color2luminance + 0.05));
 
 if(ratio < wacgVar) {result='PASS';}else{ result= 'FAIL';}

  return ratio;
}

//----check----//	
var x = 2;
var dd = 2;		
function myFunction() {

var divInp =document.createElement("li");
var inp = document.createElement("INPUT");
var inptxt = document.createElement("INPUT");
var rem = document.createElement("button");
  inp.setAttribute("type", "color");
  rem.setAttribute("class", "removeBtn btn btn-danger");
  rem.innerHTML = "x";
  divInp.setAttribute("id", "color-"+x);
  rem.setAttribute("onclick", "myRemove(this)");
  divInp.appendChild(inp);
    divInp.appendChild(inptxt);

  divInp.appendChild(rem);
  document.getElementById("container").appendChild(divInp);
  
  //document.body.appendChild(divInp);
  x = x+1;
  dd++;
  hideBtn(dd);
  return x;

}

function myRemove(el){
	var xc = document.getElementById("container").getElementsByTagName("li").length; 
	var element = el.parentElement;
	 element.remove();
	 x = x-1;
	
	for ( i = xc-2; i >= 0 ; i--){
		var elA =i +1;
		var elB ="color-" + i;
		var xcLi = document.getElementById("container").getElementsByTagName("li")[i];
		xcLi.setAttribute("id", elB);

	}
	dd--;
	hideBtn(dd);
	return x;
}
	var html;	
function hideBtn(dd){
	var rmHideBtn = document.querySelectorAll(".removeBtn");

	if (dd === 2){
	rmHideBtn.forEach(function(div) {
 	 div.setAttribute("style", "display:none");
		});
	}else{

		rmHideBtn.forEach(function(div) {
 	 div.setAttribute("style", "display:block");
		});
	}
}
function CheckFunc(){
	var arr = [];
	var valC ="";
	html ="";

	document.getElementById("arrayHere").innerHTML = "";
	var xc = document.getElementById("container").getElementsByTagName("li").length; 
	//html += "<table>;
	html += "<p>Brand Colours Matrix WACG 2.0 level " + wacgTxt +" Text Size<p><table id ='bypassme'><tr><th class='txt-90' rowspan = " + xc+1 +" >background</th></tr><tr><th colspan = "+ xc+1 + " >Font</th></tr>";
	for (i = 0 ; i <= xc-1 ; i++){
			var cc = document.getElementById("color-"+ i);
			var cc0 = cc.getElementsByTagName("input")[0].value;
			arr.push(cc0);
		}
	for(g = 0; g < arr.length; g++){
		if (g == 0){
				html += "<tr style='height:10px;'><td colspan='2' style='height:10px;''></td>";	
				for (yz = 0; yz < arr.length; yz++){
				html += "<td style='height:10px; background-color:"+ arr[yz] +"'></td>";    	
	      		}
				html += "<tr><td colspan='2'></td>";	
				for (y = 0; y < arr.length; y++){
				html += "<td class='boldCell-bottom'>" + arr[y] + "</td>";    	
	      	}
	      html += "</tr>";
		}
		
		if (arr.length > g > 0 ){
				html += "<tr><td style='width:10px; background-color:"+ arr[g] +"'></td><td class='boldCell-right'>" + arr[g] + "</td>";	
				for (x = 0; x < arr.length; x++){
				compair(arr[g], arr, x);
		      	}
	      		html += "</tr>";
 
		}else{
			html += "</table>";

		} 	
	}	     
    document.getElementById("arrayHere").innerHTML = html;

}
function compair(arrX, arr){
		calculateRatio(arrX, arr[x])

		if(result == 'PASS'){

			html += "<td style='background-color:" 
			+ arrX + 
			"; color:" 
			+ arr[x] + ";'>PASS</td>";
		}
		else{
			html += "<td></td>";
		}

}
</script>	

</body>
<html>
